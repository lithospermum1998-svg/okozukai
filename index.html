<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>MONEY LOG PRO</title>

<style>
/* 既存のスタイルを継承しつつCALC用を追加 */
:root {
  --bg-color: #f2f2f7; 
  --card-bg: #ffffff;
  --text-main: #1c1c1e;
  --text-sub: #8e8e93; 
  --radius: 20px;
  --input-bg: #fafafa;
  --input-border: #e5e5ea;
  --btn-light: #e5e5ea;
  --btn-active: #636366; 
  --accent: #007aff;
  --tax-red: #ff3b30;
}

@keyframes popIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
.new-item { animation: popIn 0.3s ease-out; }

body { font-family: -apple-system, sans-serif; background: var(--bg-color); margin: 0; padding: 12px; color: var(--text-main); }
.container { max-width: 420px; margin: 0 auto; }
.island-header { background: var(--card-bg); border-radius: var(--radius); padding: 12px 16px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
.island-header h1 { font-size: 16px; margin: 0 0 12px; text-align: center; letter-spacing: 2px; font-weight: 800; }
.header-tabs { display: flex; background: #e5e5ea; border-radius: 10px; padding: 2px; }
.header-tabs button { flex: 1; padding: 8px 0; border: none; background: transparent; font-weight: bold; font-size: 12px; color: var(--text-sub); }
.header-tabs button.active { background: var(--card-bg); border-radius: 8px; color: var(--text-main); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

.island-main { background: var(--card-bg); border-radius: var(--radius); padding: 16px 20px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
.island-title { font-size: 11px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; border-left: 3px solid var(--text-sub); padding-left: 8px; text-transform: uppercase; }
.valuation { font-size: 26px; font-weight: 800; text-align: center; margin: 10px 0; }
.profit-line { display: flex; justify-content: center; gap: 10px; font-size: 11px; color: var(--text-sub); }

.input-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
.stock-label { font-size: 9px; color: var(--text-sub); margin-bottom: 4px; display: block; }
.ios-input { width: 100%; box-sizing: border-box; padding: 10px; font-size: 13px; border: 1px solid var(--input-border); border-radius: 10px; background: var(--input-bg); }
.btn-calc { width: 100%; padding: 14px; border-radius: 12px; border: none; background: var(--btn-active); color: white; font-weight: 700; margin-top: 12px; }

.page { display: none; }
.page.active { display: block; }
.result-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--input-border); font-size: 14px; }
</style>
</head>

<body>
<div class="container">
  <div class="island-header">
    <h1>MONEY LOG</h1>
    <div class="header-tabs">
      <button id="tab-log" onclick="switchPage('logPage')">HOME</button>
      <button id="tab-stock" onclick="switchPage('stockPage')">NISA</button>
      <button id="tab-calc" class="active" onclick="switchPage('calcPage')">TAX CALC</button>
    </div>
  </div>

  <div id="calcPage" class="page active">
    <div class="island-main">
      <div class="island-title">Current Asset (特定口座)</div>
      <div class="valuation">¥<span id="currentTaxableTotal">0</span></div>
      <div class="profit-line" id="taxableSummaryLine"></div>
    </div>

    <div class="island-main">
      <div class="island-title">Tax Simulator (20.315%)</div>
      <div class="input-grid-3">
        <div><span class="stock-label">取得総額(万)</span><input id="sim-b" class="ios-input" type="number" placeholder="例:100"></div>
        <div><span class="stock-label">売却予想(万)</span><input id="sim-s" class="ios-input" type="number" placeholder="例:150"></div>
        <div style="display:flex; flex-direction:column; justify-content:flex-end;">
          <button class="btn-calc" style="margin:0; padding:10px; font-size:11px;" onclick="runSim()">計算</button>
        </div>
      </div>
    </div>

    <div id="simResult" class="island-main new-item" style="display:none;">
      <div class="island-title">Simulation Result</div>
      <div class="valuation" id="simNet" style="color:var(--accent);">¥0</div>
      <div id="simDetails"></div>
    </div>
  </div>

  <div id="logPage" class="page"> </div>
  <div id="stockPage" class="page"> </div>
</div>

<script>
// 特定口座銘柄のデータ構造（NASDAQゴールドプラス等を想定）
let state = {
  taxableStocks: JSON.parse(localStorage.getItem('taxableStocks')) || [
    { name: "NASDAQゴールドプラス", price: 0, holding: 0, cost: 0 }
  ],
  // ...他のstate
};

function switchPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.header-tabs button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-' + id.replace('Page','')).classList.add('active');
  if(id === 'calcPage') renderTaxableAssets();
}

function renderTaxableAssets() {
    let totalValuation = 0;
    // ここで特定口座分の銘柄を計算して表示するロジック
    // ※INVESTページと同様のロジックをtaxableStocksに対して適用
    document.getElementById('currentTaxableTotal').textContent = totalValuation.toLocaleString();
}

function runSim() {
  const b = parseFloat(document.getElementById('sim-b').value) * 10000;
  const s = parseFloat(document.getElementById('sim-s').value) * 10000;
  if(!b || !s) return;

  const profit = s - b;
  const tax = profit > 0 ? Math.floor(profit * 0.20315) : 0;
  const net = s - tax;

  document.getElementById('simNet').textContent = "¥" + Math.floor(net).toLocaleString();
  document.getElementById('simDetails').innerHTML = `
    <div class="result-item"><span>売却総額</span><span>¥${s.toLocaleString()}</span></div>
    <div class="result-item" style="color:var(--tax-red)"><span>譲渡税(概算)</span><span>-¥${tax.toLocaleString()}</span></div>
    <div class="result-item" style="font-weight:bold;"><span>純利益</span><span>¥${(profit-tax).toLocaleString()}</span></div>
  `;
  document.getElementById('simResult').style.display = 'block';
}

// 初期化
switchPage('calcPage');
</script>
</body>
</html>
