<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>MONEY LOG</title>

  <style>
    :root {
      --ios-blue:#007aff; --ios-green:#34c759;
      --bg:#f2f2f7; --card:#fff; --sub:#8e8e93;
      --r:12px;
    }
    body{
      margin:0;padding:16px;background:var(--bg);
      font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    }
    .container{max-width:420px;margin:auto;background:var(--card);
      border-radius:20px;padding:20px;}
    h1{text-align:center;margin:0 0 10px 0;}
    .tabs{display:flex;background:#e3e3e8;border-radius:10px;padding:2px;}
    .tabs button{flex:1;border:none;padding:8px;border-radius:8px;
      font-weight:bold;color:var(--sub);background:none;}
    .tabs button.active{background:var(--ios-blue);color:#fff;}
    .page{display:none;} .page.active{display:block;}
    .summary{background:var(--bg);padding:14px;border-radius:var(--r);
      text-align:center;margin:16px 0;}
    .stock{background:#fff;border-radius:var(--r);padding:14px;margin-bottom:12px;}
    .name{font-weight:bold;font-size:14px;}
    .val{font-size:22px;font-weight:800;color:var(--ios-green);}
    input{width:100%;padding:8px;margin-top:4px;border-radius:8px;border:1px solid #e5e5ea;}
  </style>
</head>

<body>
<div class="container">

<h1>MONEY LOG</h1>
<div class="tabs">
  <button id="tLog" class="active" onclick="sw('log')">家計</button>
  <button id="tNisa" onclick="sw('nisa')">NISA</button>
</div>

<div id="log" class="page active">
  <div class="summary">
    <div style="font-size:12px;color:var(--sub)">今月の支出</div>
    <div id="total" style="font-size:26px;font-weight:800">0 円</div>
  </div>
</div>

<div id="nisa" class="page">
  <div id="stocks"></div>
  <div class="summary">
    <div style="font-size:12px;color:var(--sub)">NISA 合計評価額</div>
    <div id="nisaTotal" style="font-size:24px;font-weight:800">0 円</div>
  </div>
</div>

</div>

<script>
/* ==== URLパラメータ受信 ==== */
const p = new URLSearchParams(location.search);
const prices = {
  g: parseInt(p.get('g')) || null,
  w: parseInt(p.get('w')) || null,
  s: parseInt(p.get('s')) || null
};

/* ==== 状態 ==== */
let stocks = JSON.parse(localStorage.getItem('stocks')) || [
  { name:'ブラックロック・ゴールド', price:14500, holding:0, key:'g' },
  { name:'WCM世界成長株激選', price:0, holding:0, key:'w' },
  { name:'SMT米国トレンドランキング', price:0, holding:0, key:'s' }
];

/* ==== URLから来た価格を反映 ==== */
stocks.forEach(s=>{
  if(prices[s.key]) s.price = prices[s.key];
});
localStorage.setItem('stocks', JSON.stringify(stocks));

/* ==== UI ==== */
function sw(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  tLog.classList.toggle('active',id==='log');
  tNisa.classList.toggle('active',id==='nisa');
  if(id==='nisa') render();
}

function render(){
  let total=0;
  stocksEl.innerHTML = stocks.map((s,i)=>{
    const v=Math.floor(s.price*s.holding/10000);
    total+=v;
    return `
      <div class="stock">
        <div class="name">${s.name}</div>
        <div class="val">¥${v.toLocaleString()}</div>
        <input type="number" value="${s.price}" onchange="upd(${i},'price',this.value)">
        <input type="number" value="${s.holding}" onchange="upd(${i},'holding',this.value)">
      </div>`;
  }).join('');
  nisaTotal.textContent = total.toLocaleString()+' 円';
}

function upd(i,f,v){
  stocks[i][f]=parseInt(v)||0;
  localStorage.setItem('stocks',JSON.stringify(stocks));
  render();
}

const stocksEl=document.getElementById('stocks');
render();
</script>
</body>
</html>
