<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>MONEY LOG PRO</title>
  <style>
    :root {
      --ios-blue: #007aff;
      --ios-green: #34c759;
      --ios-red: #ff3b30;
      --bg-color: #f2f2f7;
      --card-bg: #ffffff;
      --text-main: #1c1c1e;
      --text-sub: #8e8e93;
      --radius: 12px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-color);
      margin: 0; padding: 16px;
      color: var(--text-main);
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
    }

    .container { max-width: 420px; margin: 0 auto; background: var(--card-bg); border-radius: 20px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }

    /* ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ */
    .page { display: none; }
    .page.active { display: block; }

    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    header h1 { font-size: 20px; margin: 0; flex: 1; text-align: center; letter-spacing: 1px; }
    .nav-btn { color: var(--ios-blue); font-weight: bold; cursor: pointer; width: 70px; font-size: 14px; border:none; background:none; }

    /* åæ”¯ãƒ­ã‚°ç”¨ */
    .summary { background: var(--bg-color); padding: 15px; border-radius: var(--radius); text-align: center; margin-bottom: 20px; }
    #monthlyTotal { font-size: 28px; font-weight: 800; }
    input { width: 100%; box-sizing: border-box; font-size: 16px; padding: 12px; margin-bottom: 10px; border: 1px solid #e5e5ea; border-radius: var(--radius); background: #fafafa; }

    .action-row { display: flex; gap: 10px; }
    .btn { flex: 1; padding: 14px; border-radius: var(--radius); border: none; color: white; font-weight: bold; font-size: 16px; }
    .btn-record { background: var(--ios-blue); }
    .btn-invest { background: var(--ios-green); }

    /* éŠ˜æŸ„ã‚«ãƒ¼ãƒ‰ç”¨ */
    .stock-card { background: #f9f9fb; padding: 16px; border-radius: var(--radius); margin-bottom: 15px; border: 1px solid #e5e5ea; }
    .stock-name { font-weight: bold; font-size: 14px; margin-bottom: 8px; color: var(--text-main); }
    .valuation { font-size: 24px; font-weight: 800; margin-bottom: 10px; }
    .stock-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .stock-inputs div { font-size: 11px; color: var(--text-sub); }
    .stock-inputs input { padding: 6px; font-size: 13px; margin-bottom: 4px; }

    /* ãƒªã‚¹ãƒˆè¡¨ç¤º */
    #expenseList { list-style: none; padding: 0; margin-top: 20px; }
    .swipe-item { position: relative; overflow: hidden; background-color: var(--ios-red); border-radius: 8px; margin-bottom: 1px; }
    .item-content { display: flex; justify-content: space-between; padding: 12px 16px; background: white; position: relative; z-index: 2; transition: 0.3s; border-bottom: 1px solid #f2f2f7; }
    .editing-record { background: #e1f0ff !important; }
    .editing-invest { background: #e8f9ee !important; }
    .amount.record { color: var(--ios-blue); font-weight: bold; }
    .amount.invest { color: var(--ios-green); font-weight: bold; }
    .swipe-delete-btn { position: absolute; right: 0; top: 0; bottom: 0; width: 80px; background: var(--ios-red); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
  </style>
</head>
<body onclick="handleGlobalClick()">

<div class="container" onclick="event.stopPropagation()">
  
  <div id="logPage" class="page active">
    <!-- æ–°ã—ã„ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
      <div style="width:70px"></div>
      <h1>MONEY LOG PRO</h1>
      <button class="nav-btn" onclick="switchPage('stockPage')">ä¿æœ‰éŠ˜æŸ„ ğŸ“Š</button>
    </header>

    <div class="summary">
      <div style="font-size:12px; color:var(--text-sub)">ä»Šæœˆã®æ”¯å‡ºåˆè¨ˆ</div>
      <span id="monthlyTotal">0</span><small> å††</small>
    </div>
    <input type="date" id="dateInput">
    <input type="number" id="amountInput" placeholder="é‡‘é¡" inputmode="decimal">
    <input type="text" id="memoInput" placeholder="ãƒ¡ãƒ¢">
    <div class="action-row">
      <button class="btn btn-record" onclick="addEntry('record')">è¨˜éŒ²</button>
      <button class="btn btn-invest" onclick="addEntry('invest')">æŠ•è³‡</button>
    </div>
    <ul id="expenseList"></ul>
  </div>

  <div id="stockPage" class="page">
    <!-- æ–°ã—ã„ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
      <button class="nav-btn" onclick="switchPage('logPage')">â—€ æˆ»ã‚‹</button>
      <h1>MY ASSETS</h1>
      <div style="width:70px"></div>
    </header>
    <div id="stockList"></div>
  </div>

</div>

<script>
  let state = {
    expenses: JSON.parse(localStorage.getItem('expenses')) || [],
    stocks: JSON.parse(localStorage.getItem('stocks')) || [
      { name: "ãƒ–ãƒ©ãƒƒã‚¯ãƒ­ãƒƒã‚¯ãƒ»ã‚´ãƒ¼ãƒ«ãƒ‰", price: 0, holding: 0 },
      { name: "WCMä¸–ç•Œæˆé•·æ ªæ¿€é¸", price: 0, holding: 0 },
      { name: "SMTç±³å›½ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°", price: 0, holding: 0 }
    ],
    currentView: new Date(),
    editingId: null
  };

  function switchPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'stockPage') renderStocks();
  }

  function renderStocks() {
    const container = document.getElementById('stockList');
    container.innerHTML = state.stocks.map((s, i) => {
      const valuation = Math.floor((s.price * s.holding) / 10000);
      return `
        <div class="stock-card">
          <div class="stock-name">${s.name}</div>
          <div class="valuation">Â¥${valuation.toLocaleString()}</div>
          <div class="stock-inputs">
            <div>
              åŸºæº–ä¾¡é¡ (1ä¸‡å£å½“ã‚Š)
              <input type="number" value="${s.price}" onchange="updateStock(${i}, 'price', this.value)" inputmode="decimal">
            </div>
            <div>
              ä¿æœ‰å£æ•°
              <input type="number" value="${s.holding}" onchange="updateStock(${i}, 'holding', this.value)" inputmode="decimal">
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  function updateStock(index, field, value) {
    state.stocks[index][field] = parseFloat(value) || 0;
    localStorage.setItem('stocks', JSON.stringify(state.stocks));
    renderStocks();
  }

  function addEntry(type) {
    const amount = parseInt(document.getElementById('amountInput').value);
    if(!amount) return;
    if(state.editingId) state.expenses = state.expenses.filter(e => e.id !== state.editingId);
    state.expenses.push({
      id: Date.now(),
      type, amount,
      memo: document.getElementById('memoInput').value,
      date: document.getElementById('dateInput').value
    });
    cancelEdit();
    save();
  }

  function save() {
    localStorage.setItem('expenses', JSON.stringify(state.expenses));
    updateUI();
  }

  function cancelEdit() {
    state.editingId = null;
    document.getElementById('amountInput').value = "";
    document.getElementById('memoInput').value = "";
    updateUI();
  }

  function handleGlobalClick() { if(state.editingId) cancelEdit(); }

  function updateUI() {
    const list = document.getElementById('expenseList');
    const now = state.currentView;
    const filtered = state.expenses.filter(e => {
      const d = new Date(e.date);
      return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth();
    });

    document.getElementById('monthlyTotal').textContent = filtered.reduce((s, e) => s + e.amount, 0).toLocaleString();
    list.innerHTML = filtered.sort((a,b) => new Date(a.date) - new Date(b.date)).map(e => `
      <li class="swipe-item" onclick="event.stopPropagation()">
        <div class="swipe-delete-btn" onclick="deleteEntry(${e.id})">å‰Šé™¤</div>
        <div class="item-content ${state.editingId === e.id ? 'editing-'+e.type : ''}" 
             onclick="state.editingId === ${e.id} ? cancelEdit() : null"
             ontouchstart="handleStart(event, ${e.id})" ontouchend="clearTimeout(window.ptimer)" ontouchmove="handleMove(event)">
          <div>
            <div class="amount ${e.type}">Â¥${e.amount.toLocaleString()}</div>
            <div style="font-size:11px; color:var(--text-sub)">${e.date.slice(5)} ${e.memo}</div>
          </div>
        </div>
      </li>
    `).join('');
  }

  function deleteEntry(id) { state.expenses = state.expenses.filter(e => e.id !== id); save(); }
  
  let startX = 0;
  function handleStart(e, id) { 
    startX = e.touches[0].pageX; 
    window.ptimer = setTimeout(() => {
      const target = state.expenses.find(ex => ex.id === id);
      state.editingId = id;
      document.getElementById('amountInput').value = target.amount;
      document.getElementById('memoInput').value = target.memo;
      document.getElementById('dateInput').value = target.date;
      updateUI();
    }, 800);
  }
  function handleMove(e) {
    clearTimeout(window.ptimer);
    const diff = startX - e.touches[0].pageX;
    if(diff > 60) e.currentTarget.style.transform = "translateX(-80px)";
    if(diff < -60) e.currentTarget.style.transform = "translateX(0px)";
  }

  document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];
  updateUI();
</script>
</body>
</html>
