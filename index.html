<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>MONEY LOG Premium</title>
<style>
:root {
  --bg: #0b0e14;
  --card: #1c212c;
  --accent: #6366f1;
  --text: #f8fafc;
  --text-dim: #94a3b8;
  --up: #10b981;
  --down: #ef4444;
  --radius: 24px;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0; padding: 20px;
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
}

.container { max-width: 400px; margin: 0 auto; }

/* Header & Tabs */
header { margin-bottom: 24px; text-align: center; }
h1 { font-size: 14px; font-weight: 900; letter-spacing: 0.2em; color: var(--text-dim); margin-bottom: 16px; }

.tabs {
  display: flex; background: #161b26; border-radius: 16px; padding: 4px;
}
.tabs button {
  flex: 1; padding: 10px; border: none; background: transparent;
  color: var(--text-dim); font-weight: 700; font-size: 13px; border-radius: 12px;
  transition: 0.2s;
}
.tabs button.active {
  background: var(--card); color: var(--text); box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* Common UI */
.island {
  background: var(--card); border-radius: var(--radius); padding: 20px;
  margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.05);
}
.label { font-size: 11px; font-weight: 700; color: var(--text-dim); margin-bottom: 6px; display: block; }
.valuation { font-size: 32px; font-weight: 800; letter-spacing: -1px; margin: 4px 0; }

/* Input */
.input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 16px 0; }
input {
  background: #0b0e14; border: 1px solid #2d3748; border-radius: 14px;
  padding: 12px; color: var(--text); font-size: 15px; outline: none;
}
input:focus { border-color: var(--accent); }

.btn-main {
  width: 100%; padding: 14px; border-radius: 16px; border: none;
  background: var(--accent); color: white; font-weight: 800; font-size: 15px;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

/* Stock Card */
.stock-card {
  background: var(--card); border-radius: 20px; padding: 16px; margin-bottom: 12px;
  border: 1px solid rgba(255,255,255,0.03);
}
.stock-name-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.stock-link { font-size: 14px; font-weight: 800; color: var(--accent); text-decoration: none; }
.stock-price-display { font-size: 20px; font-weight: 800; }

.mini-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 12px; }
.mini-input-box span { font-size: 9px; color: var(--text-dim); display: block; margin-bottom: 4px; }
.mini-input-box input { padding: 8px; font-size: 12px; width: 100%; box-sizing: border-box; }

.profit-tag {
  display: inline-block; padding: 2px 8px; border-radius: 8px; font-size: 11px; font-weight: 800; margin-top: 4px;
}

.page { display: none; }
.page.active { display: block; }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>MONEY LOG</h1>
    <div class="tabs">
      <button id="tab-log" class="active" onclick="switchPage('logPage')">EXPENSE</button>
      <button id="tab-stock" onclick="switchPage('stockPage')">INVEST</button>
    </div>
  </header>

  <div id="logPage" class="page active">
    <div class="island">
      <span class="label">MONTHLY TOTAL</span>
      <div class="valuation">¥<span id="monthlyTotal">0</span></div>
      <div class="input-group">
        <input type="number" id="amountInput" placeholder="金額">
        <input type="text" id="memoInput" placeholder="メモ">
      </div>
      <button class="btn-main" onclick="addEntry()">記録を追加</button>
    </div>
    <div id="expenseList"></div>
  </div>

  <div id="stockPage" class="page">
    <div class="island">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <span class="label">TOTAL ASSETS</span>
        <button onclick="snapshot()" style="font-size:10px; color:var(--accent); background:none; border:none; font-weight:bold; cursor:pointer;">[ 基準値を更新 ]</button>
      </div>
      <div class="valuation">¥<span id="stockTotal">0</span></div>
      <div id="totalProfitLine" style="font-size:12px; font-weight:bold; text-align:center;"></div>
    </div>
    <div id="stockList"></div>
  </div>
</div>

<script>
let state = {
  expenses: JSON.parse(localStorage.getItem('expenses')) || [],
  stocks: JSON.parse(localStorage.getItem('stocks')) || [
    { name: "ブラックロック・ゴールド", ticker: "48311032", price: 0, holding: 0, cost: 0, base: 0 },
    { name: "WCM世界成長株激選", ticker: "6831121A", price: 0, holding: 0, cost: 0, base: 0 },
    { name: "SMT米国トレンド", ticker: "6431225C", price: 0, holding: 0, cost: 0, base: 0 }
  ],
  baseTotal: parseInt(localStorage.getItem('baseTotal')) || 0
};

function save() {
  localStorage.setItem('expenses', JSON.stringify(state.expenses));
  localStorage.setItem('stocks', JSON.stringify(state.stocks));
  localStorage.setItem('baseTotal', state.baseTotal);
  render();
}

function switchPage(p) {
  document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
  document.getElementById(p).classList.add('active');
  document.getElementById('tab-log').classList.toggle('active', p==='logPage');
  document.getElementById('tab-stock').classList.toggle('active', p==='stockPage');
  render();
}

function addEntry() {
  const a = document.getElementById('amountInput'), m = document.getElementById('memoInput');
  if(!a.value) return;
  state.expenses.push({ id: Date.now(), amount: parseInt(a.value), memo: m.value, date: new Date().toISOString() });
  a.value = ''; m.value = ''; save();
}

function updateStock(i, field, val) {
  state.stocks[i][field] = parseFloat(val) || 0;
  save();
}

function snapshot() {
  if(!confirm("現在の合計額を『基準（±0）』として設定しますか？")) return;
  let currentTotal = 0;
  state.stocks.forEach((s, i) => {
    const val = Math.floor((s.price * s.holding) / 10000);
    state.stocks[i].base = val;
    currentTotal += val;
  });
  state.baseTotal = currentTotal;
  save();
}

function render() {
  // Expense
  const now = new Date();
  const filtered = state.expenses.filter(e => e.date.startsWith(now.toISOString().substring(0,7)));
  document.getElementById('monthlyTotal').textContent = filtered.reduce((s,e)=>s+e.amount, 0).toLocaleString();
  document.getElementById('expenseList').innerHTML = filtered.slice().reverse().map(e => `
    <div class="island" style="display:flex; justify-content:space-between; padding:15px; margin-bottom:8px;">
      <span style="font-weight:bold;">${e.memo || '無題'}</span>
      <span style="color:var(--text-dim);">¥${e.amount.toLocaleString()}</span>
    </div>
  `).join('');

  // Invest
  let totalVal = 0;
  document.getElementById('stockList').innerHTML = state.stocks.map((s, i) => {
    const currentVal = Math.floor((s.price * s.holding) / 10000);
    totalVal += currentVal;
    const diffBase = currentVal - (s.base || currentVal);
    const diffCost = currentVal - s.cost;

    return `
      <div class="stock-card">
        <div class="stock-name-row">
          <a class="stock-link" href="https://www.google.com/search?q=${encodeURIComponent(s.name + ' 基準価額')}" target="_blank">${s.name} ↗</a>
          <div class="stock-price-display">¥${currentVal.toLocaleString()}<span style="font-size:12px; color:var(--text-dim); margin-left:4px;">万</span></div>
        </div>
        
        <div style="display:flex; gap:8px;">
          <div class="profit-tag" style="background:rgba(255,255,255,0.05); color:var(--text-dim);">Cost: ${diffCost >= 0 ? '+' : ''}${diffCost}万</div>
          <div class="profit-tag" style="background:${diffBase >= 0 ? 'rgba(16,185,129,0.1)' : 'rgba(239,68,68,0.1)'}; color:${diffBase >= 0 ? 'var(--up)' : 'var(--down)'};">
            Base: ${diffBase >= 0 ? '+' : ''}${diffBase}万
          </div>
        </div>

        <div class="mini-grid">
          <div class="mini-input-box"><span>基準価額(円)</span><input type="number" value="${s.price}" onchange="updateStock(${i},'price',this.value)"></div>
          <div class="mini-input-box"><span>保有口数</span><input type="number" value="${s.holding}" onchange="updateStock(${i},'holding',this.value)"></div>
          <div class="mini-input-box"><span>元本(万円)</span><input type="number" value="${s.cost}" onchange="updateStock(${i},'cost',this.value)"></div>
        </div>
      </div>
    `;
  }).join('');

  document.getElementById('stockTotal').textContent = totalVal.toLocaleString();
  const totalDiff = totalVal - state.baseTotal;
  document.getElementById('totalProfitLine').innerHTML = `
    <span style="color:var(--text-dim)">PREV RATIO: </span>
    <span style="color:${totalDiff >= 0 ? 'var(--up)' : 'var(--down)'}">${totalDiff >= 0 ? '+' : ''}${totalDiff.toLocaleString()} 万円</span>
  `;
}

render();
</script>
</body>
</html>
